<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Face Detector Demo</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f0f0f0;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      h1 {
        text-align: center;
        color: #333;
      }

      .demo-section {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
      }

      .camera-container {
        flex: 1;
        background: #000;
        border-radius: 8px;
        overflow: hidden;
        min-height: 400px;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .controls {
        flex: 0 0 320px;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .status {
        margin-bottom: 20px;
        padding: 10px;
        border-radius: 4px;
        font-weight: bold;
        text-align: center;
      }

      .status.good {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .status.warning {
        background-color: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
      }

      .status.error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      button {
        width: 100%;
        padding: 10px;
        margin: 5px 0;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
      }

      .btn-primary {
        background-color: #007bff;
        color: white;
      }

      .btn-success {
        background-color: #28a745;
        color: white;
      }

      .btn-danger {
        background-color: #dc3545;
        color: white;
      }

      .btn-secondary {
        background-color: #6c757d;
        color: white;
      }

      button:hover {
        opacity: 0.8;
      }

      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .log {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 10px;
        max-height: 200px;
        overflow-y: auto;
        font-family: monospace;
        font-size: 12px;
      }

      .log-entry {
        margin-bottom: 5px;
        padding: 2px 0;
      }

      .log-entry.error {
        color: #dc3545;
      }

      .log-entry.warning {
        color: #ffc107;
      }

      .log-entry.success {
        color: #28a745;
      }

      .log-entry.info {
        color: #17a2b8;
      }

      .instructions {
        background: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .instructions h3 {
        margin-top: 0;
        color: #333;
      }

      .instructions ul {
        padding-left: 20px;
      }

      .instructions li {
        margin-bottom: 5px;
      }

      .placeholder-text {
        color: white;
        font-size: 18px;
        text-align: center;
        z-index: 1;
      }

      /* Video styling */
      .camera-container video {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 8px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Face Detector Demo</h1>

      <div class="instructions">
        <h3>Instructions:</h3>
        <ul>
          <li>Click "Start Camera" to begin face detection</li>
          <li>
            The system expects exactly <strong>1 person</strong> on screen
          </li>
          <li>
            Try moving in and out of frame, or having multiple people in view
          </li>
          <li>Enable debug mode to see face detection rectangles</li>
          <li>Check the log below for detailed event information</li>
        </ul>
      </div>

      <div class="demo-section">
        <div class="camera-container" id="cameraDiv">
          <div class="placeholder-text">Camera will appear here</div>
        </div>

        <div class="controls">
          <div class="status" id="status">Ready to start</div>

          <button id="startBtn" class="btn-primary">Start Camera</button>
          <button id="stopBtn" class="btn-danger" disabled>Stop Camera</button>

          <hr />

          <h4>Settings:</h4>
          <div style="margin-bottom: 10px">
            <label style="display: block; margin-bottom: 5px"
              >Horizontal Sensitivity:</label
            >
            <input
              type="range"
              id="horizontalSlider"
              min="0.05"
              max="0.3"
              step="0.01"
              value="0.15"
              style="width: 100%"
            />
            <span id="horizontalValue">0.15</span>
          </div>

          <div style="margin-bottom: 10px">
            <label style="display: block; margin-bottom: 5px"
              >Vertical Sensitivity:</label
            >
            <input
              type="range"
              id="verticalSlider"
              min="0.03"
              max="0.15"
              step="0.01"
              value="0.08"
              style="width: 100%"
            />
            <span id="verticalValue">0.08</span>
          </div>

          <label>
            <input type="checkbox" id="smoothingToggle" checked /> Enable
            Smoothing
          </label>

          <hr />

          <h4>Event Log:</h4>
          <div class="log" id="eventLog"></div>
          <button id="clearLogBtn" class="btn-secondary">Clear Log</button>
        </div>
      </div>
    </div>

    <script src="face-detector.js"></script>
    <script>
      class Demo {
        constructor() {
          this.detector = new FaceDetector();
          this.isRunning = false;
          this.initializeElements();
          this.setupEventListeners();
          this.setupDetectorEvents();
        }

        initializeElements() {
          this.startBtn = document.getElementById("startBtn");
          this.stopBtn = document.getElementById("stopBtn");
          this.status = document.getElementById("status");
          this.eventLog = document.getElementById("eventLog");
          this.clearLogBtn = document.getElementById("clearLogBtn");
          this.cameraDiv = document.getElementById("cameraDiv");
        }

        setupEventListeners() {
          this.startBtn.addEventListener("click", () => this.startCamera());
          this.stopBtn.addEventListener("click", () => this.stopCamera());
          this.clearLogBtn.addEventListener("click", () => this.clearLog());
        }

        setupDetectorEvents() {
          this.detector.addEventListener("initialized", () => {
            this.log("Face detector initialized successfully", "success");
          });

          this.detector.addEventListener("singlePerson", (event) => {
            this.updateStatus("✓ Single person detected", "good");
            this.log(
              `✓ Single person detected (confidence: ${(
                event.detail.detection.categories[0]?.score * 100
              ).toFixed(1)}%)`,
              "success"
            );
          });

          this.detector.addEventListener("noPerson", (event) => {
            this.updateStatus("⚠ No person detected", "warning");
            this.log("⚠ No person detected on screen", "warning");
          });

          this.detector.addEventListener("multiplePeople", (event) => {
            this.updateStatus(
              `✗ ${event.detail.count} people detected`,
              "error"
            );
            this.log(
              `✗ Multiple people detected: ${event.detail.count} people. Only 1 person should be on screen`,
              "error"
            );
          });

          this.detector.addEventListener("error", (event) => {
            this.updateStatus("Error occurred", "error");
            this.log(`Error: ${event.detail.message}`, "error");
          });

          this.detector.addEventListener("stopped", () => {
            this.log("Face detector stopped", "info");
          });
        }

        async startCamera() {
          try {
            this.startBtn.disabled = true;
            this.updateStatus("Starting camera...", "warning");

            await this.detector.init(this.cameraDiv);

            this.isRunning = true;
            this.startBtn.disabled = true;
            this.stopBtn.disabled = false;
            this.updateStatus("Camera started", "good");
            this.log("Camera started successfully", "success");
          } catch (error) {
            this.startBtn.disabled = false;
            this.updateStatus("Failed to start camera", "error");
            this.log(`Failed to start camera: ${error.message}`, "error");
          }
        }

        stopCamera() {
          this.detector.stop();
          this.isRunning = false;
          this.startBtn.disabled = false;
          this.stopBtn.disabled = true;
          this.updateStatus("Camera stopped", "warning");
          this.log("Camera stopped", "info");
        }

        updateStatus(message, type) {
          this.status.textContent = message;
          this.status.className = `status ${type}`;
        }

        log(message, type = "info") {
          const timestamp = new Date().toLocaleTimeString();
          const entry = document.createElement("div");
          entry.className = `log-entry ${type}`;
          entry.textContent = `[${timestamp}] ${message}`;

          this.eventLog.appendChild(entry);
          this.eventLog.scrollTop = this.eventLog.scrollHeight;
        }

        clearLog() {
          this.eventLog.innerHTML = "";
        }
      }

      // Initialize demo when page loads
      document.addEventListener("DOMContentLoaded", () => {
        new Demo();
      });
    </script>
  </body>
</html>
