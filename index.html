<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MediaPipe Face Detection with Gaze Tracking - Using Gazer.js</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
    />

    <style>
      /* Minimal custom styles */
      .video-wrapper {
        border: 2px solid #dee2e6;
        border-radius: 0.375rem;
        overflow: hidden;
        background: #f8f9fa;
        position: relative;
      }

      video {
        width: 100%;
        height: auto;
        display: block;
      }

      .stat-card {
        text-align: center;
      }

      .stat-value {
        font-size: 2rem;
        font-weight: bold;
        margin: 0;
      }

      .control-row {
        margin-bottom: 1rem;
      }

      .range-display {
        min-width: 70px;
        text-align: right;
        font-weight: bold;
        color: #0d6efd;
      }

      .full-height {
        min-height: 100vh;
      }
    </style>
  </head>
  <body class="bg-light">
    <!-- Header -->
    <div class="bg-primary text-white py-4 mb-4">
      <div class="container-fluid">
        <div class="row align-items-center">
          <div class="col-md-6">
            <h1 class="mb-0">Gazer.JS</h1>
            <p class="mb-0 text-white-50">
              MediaPipe Face Detection with Gaze Tracking
            </p>
          </div>
          <div class="col-md-6 text-end">
            <a
              href="https://github.com/lebmatter/gazerjs"
              class="text-white text-decoration-none"
              target="_blank"
            >
              <i class="bi bi-github me-2"></i>GitHub Repository
            </a>
          </div>
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row g-4">
        <!-- Column 1: Controls -->
        <div class="col-lg-4">
          <div class="card h-100">
            <div class="card-header bg-primary text-white">
              <h5 class="card-title mb-0">
                <i class="bi bi-sliders me-2"></i>Controls
              </h5>
            </div>
            <div class="card-body">
              <!-- Performance Controls -->
              <div class="mb-4">
                <h6 class="text-muted mb-3">
                  <i class="bi bi-lightning-charge me-2"></i>Performance
                </h6>

                <div class="control-row">
                  <label class="form-label">Performance Mode</label>
                  <select class="form-select" id="performanceMode">
                    <option value="low">Low - Basic tracking (10 FPS)</option>
                    <option value="medium" selected>
                      Medium - Balanced (15 FPS)
                    </option>
                    <option value="high">
                      High - Smooth tracking (25 FPS)
                    </option>
                    <option value="manual">Manual - Custom settings</option>
                  </select>
                  <small class="text-muted"
                    >Presets automatically adjust frame rate and other
                    settings</small
                  >
                </div>

                <div class="control-row">
                  <label class="form-label">Frame Rate</label>
                  <div class="d-flex align-items-center">
                    <input
                      type="range"
                      class="form-range me-3"
                      id="fpsControl"
                      min="5"
                      max="30"
                      value="15"
                    />
                    <span class="range-display" id="fpsValue">15 FPS</span>
                  </div>
                </div>

                <div class="control-row">
                  <label class="form-label">Process Every</label>
                  <div class="d-flex align-items-center">
                    <input
                      type="range"
                      class="form-range me-3"
                      id="frameSkipControl"
                      min="1"
                      max="5"
                      value="1"
                    />
                    <span class="range-display" id="frameSkipValue"
                      >1 frame</span
                    >
                  </div>
                </div>

                <div class="form-check mb-2">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="pauseOnIdle"
                    checked
                  />
                  <label class="form-check-label" for="pauseOnIdle"
                    >Pause when idle</label
                  >
                </div>

                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="reducedCanvas"
                  />
                  <label class="form-check-label" for="reducedCanvas"
                    >Reduced canvas updates</label
                  >
                </div>
              </div>

              <!-- Gaze Controls -->
              <div class="mb-4">
                <h6 class="text-muted mb-3">
                  <i class="bi bi-eye me-2"></i>Gaze Sensitivity
                </h6>

                <div class="control-row">
                  <label class="form-label">Sensitivity Mode</label>
                  <select class="form-select" id="sensitivityMode">
                    <option value="strict">
                      Strict - Precise alignment required
                    </option>
                    <option value="medium" selected>
                      Medium - Balanced sensitivity
                    </option>
                    <option value="relaxed">
                      Relaxed - Forgiving detection
                    </option>
                    <option value="manual">Manual - Custom thresholds</option>
                  </select>
                  <small class="text-muted"
                    >Presets automatically adjust gaze detection
                    thresholds</small
                  >
                </div>

                <div class="control-row">
                  <label class="form-label">Horizontal</label>
                  <div class="d-flex align-items-center">
                    <input
                      type="range"
                      class="form-range me-3"
                      id="horizontalThreshold"
                      min="0.1"
                      max="1.0"
                      step="0.1"
                      value="0.3"
                    />
                    <span class="range-display" id="horizontalValue">0.3</span>
                  </div>
                </div>

                <div class="control-row">
                  <label class="form-label">Vertical</label>
                  <div class="d-flex align-items-center">
                    <input
                      type="range"
                      class="form-range me-3"
                      id="verticalThreshold"
                      min="0.05"
                      max="0.5"
                      step="0.05"
                      value="0.15"
                    />
                    <span class="range-display" id="verticalValue">0.15</span>
                  </div>
                </div>

                <div class="control-row">
                  <label class="form-label">Smoothing</label>
                  <div class="d-flex align-items-center">
                    <input
                      type="range"
                      class="form-range me-3"
                      id="gazeHistorySize"
                      min="2"
                      max="10"
                      value="5"
                    />
                    <span class="range-display" id="gazeHistoryValue"
                      >5 frames</span
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Column 2: Video -->
        <div class="col-lg-4">
          <div class="card h-100">
            <div class="card-header bg-success text-white">
              <h5 class="card-title mb-0">
                <i class="bi bi-camera-video me-2"></i>Live Feed
              </h5>
            </div>
            <div class="card-body d-flex flex-column">
              <div class="video-wrapper mb-3">
                <video id="video" autoplay muted playsinline></video>
              </div>
              <!-- Camera Controls -->
              <div class="d-grid gap-2">
                <button id="startBtn" class="btn btn-success btn-lg">
                  <i class="bi bi-play-fill me-2"></i>Start Camera
                </button>
                <button id="stopBtn" class="btn btn-danger btn-lg" disabled>
                  <i class="bi bi-stop-fill me-2"></i>Stop Camera
                </button>
              </div>
              <!-- Display Options -->
              <div class="mb-4 mt-3">
                <h6 class="text-muted mb-3">
                  <i class="bi bi-palette me-2"></i>Display Options
                </h6>

                <div class="form-check mb-2">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="showFaceRectangle"
                    checked
                  />
                  <label class="form-check-label" for="showFaceRectangle"
                    >Show face rectangle</label
                  >
                </div>

                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="enableLogs"
                    checked
                  />
                  <label class="form-check-label" for="enableLogs"
                    >Enable console logs</label
                  >
                </div>
                <div class="form-check mb-2">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="showGazeVector"
                    checked
                  />
                  <label class="form-check-label" for="showGazeVector"
                    >Show gaze direction</label
                  >
                </div>

                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="showEyePoints"
                    checked
                  />
                  <label class="form-check-label" for="showEyePoints"
                    >Show eye tracking</label
                  >
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Column 3: Stats & Output -->
        <div class="col-lg-4">
          <div class="card h-100">
            <div class="card-header bg-info text-white">
              <h5 class="card-title mb-0">
                <i class="bi bi-graph-up me-2"></i>Stats & Output
              </h5>
            </div>
            <div class="card-body">
              <!-- Gaze Indicator -->
              <div
                class="alert alert-secondary text-center mb-4"
                role="alert"
                id="gazeIndicator"
              >
                <i class="bi bi-eye fs-4 me-2"></i>
                <strong>Gaze: Unknown</strong>
              </div>

              <!-- Main Stats -->
              <div class="row g-3 mb-4">
                <div class="col-6">
                  <div class="card stat-card bg-primary text-white">
                    <div class="card-body">
                      <p class="stat-value" id="faceCount">0</p>
                      <small>Faces Detected</small>
                    </div>
                  </div>
                </div>
                <div class="col-6">
                  <div class="card stat-card bg-warning text-dark">
                    <div class="card-body">
                      <p class="stat-value" id="awayTime">0s</p>
                      <small>Time Away</small>
                    </div>
                  </div>
                </div>
                <div class="col-6">
                  <div class="card stat-card bg-danger text-white">
                    <div class="card-body">
                      <p class="stat-value" id="distractedTime">0s</p>
                      <small>Time Distracted</small>
                    </div>
                  </div>
                </div>
                <div class="col-6">
                  <div class="card stat-card bg-success text-white">
                    <div class="card-body">
                      <p class="stat-value" id="confidence">0%</p>
                      <small>Avg Confidence</small>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Retina Tracking Stats -->
              <div class="row g-3 mb-4">
                <div class="col-12">
                  <div class="card stat-card bg-info text-white">
                    <div class="card-body">
                      <p class="stat-value" id="retinaLocationCount">0</p>
                      <small>Retina Locations Recorded</small>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Retina Tracking Controls -->
              <div class="card mb-4">
                <div class="card-header">
                  <h6 class="card-title mb-0">
                    <i class="bi bi-crosshair me-2"></i>Retina Tracking
                  </h6>
                </div>
                <div class="card-body">
                  <div class="form-check mb-2">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="trackRetinaLocations"
                      checked
                    />
                    <label class="form-check-label" for="trackRetinaLocations"
                      >Enable retina tracking</label
                    >
                  </div>
                  <div class="mb-2">
                    <label class="form-label">Change Threshold</label>
                    <div class="d-flex align-items-center">
                      <input
                        type="range"
                        class="form-range me-3"
                        id="retinaChangeThreshold"
                        min="0.01"
                        max="0.5"
                        step="0.01"
                        value="0.1"
                      />
                      <span class="range-display" id="retinaChangeValue"
                        >10%</span
                      >
                    </div>
                  </div>
                  <div class="mb-2">
                    <label class="form-label">Record Interval</label>
                    <div class="d-flex align-items-center">
                      <input
                        type="range"
                        class="form-range me-3"
                        id="retinaInterval"
                        min="1"
                        max="30"
                        step="1"
                        value="5"
                      />
                      <span class="range-display" id="retinaIntervalValue"
                        >5s</span
                      >
                    </div>
                  </div>
                  <button
                    id="forcePostData"
                    class="btn btn-sm btn-outline-info"
                  >
                    Post Tracking Data Now
                  </button>
                </div>
              </div>

              <!-- Performance Stats -->
              <div class="card">
                <div class="card-header">
                  <h6 class="card-title mb-0">
                    <i class="bi bi-speedometer2 me-2"></i>Performance
                  </h6>
                </div>
                <div class="card-body">
                  <div class="row text-center">
                    <div class="col-4">
                      <div class="text-muted small">Processing FPS</div>
                      <div class="fw-bold" id="processingFps">0</div>
                    </div>
                    <div class="col-4">
                      <div class="text-muted small">Frames Skipped</div>
                      <div class="fw-bold" id="framesSkipped">0</div>
                    </div>
                    <div class="col-4">
                      <div class="text-muted small">Canvas Updates</div>
                      <div class="fw-bold" id="canvasUpdates">0</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- MediaPipe Scripts -->
    <script
      src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@mediapipe/face_detection/face_detection.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js"
      crossorigin="anonymous"
    ></script>

    <!-- Include Gazer.js Library -->
    <script src="gazer.js"></script>
    <script>
      const gazer = new Gazer("video", {
        postTrackingDataInterval: 10, // Post tracking data every 10 seconds for demo
        onPostTrackingData: (trackingData) => {
          console.log("=== TRACKING DATA ===");
          console.log(
            "Timestamp:",
            new Date(trackingData.timestamp).toLocaleString()
          );
          console.log("Session Duration:", trackingData.sessionDuration + "s");
          console.log("Face Count Changes:", trackingData.faceCountChanges);
          console.log("Total Away Time:", trackingData.totalAwayTime + "s");
          console.log(
            "Total Distracted Time:",
            trackingData.totalDistractedTime + "s"
          );
          console.log("Current Face Count:", trackingData.currentFaceCount);
          console.log("Current Gaze State:", trackingData.currentGazeState);
          console.log("Processing FPS:", trackingData.processingFps);
          console.log("Frames Skipped:", trackingData.framesSkipped);
          console.log("Canvas Updates:", trackingData.canvasUpdates);
          console.log("Is Running:", trackingData.isRunning);
          console.log("Is Idle:", trackingData.isIdle);
          console.log(
            "Retina Locations Count:",
            trackingData.retinaLocations.length
          );

          // Log detailed retina location data
          if (trackingData.retinaLocations.length > 0) {
            console.log("=== RETINA LOCATIONS ===");
            trackingData.retinaLocations.forEach((location, index) => {
              console.log(`Location ${index + 1}:`, {
                x: location.x.toFixed(3),
                y: location.y.toFixed(3),
                confidence: location.confidence.toFixed(2),
                gazeDirection: location.gazeDirection,
                timestamp: new Date(location.timestamp).toLocaleTimeString(),
              });
            });
          }

          console.log("=====================");
        },
        onGazeChange: (gazeState, gazeData) => {
          console.log("Gaze changed to:", gazeState);

          // Update gaze indicator
          const indicator = document.getElementById("gazeIndicator");
          const icon = indicator.querySelector("i");

          indicator.className = "alert text-center mb-4";

          if (gazeState === "screen") {
            indicator.classList.add("alert-success");
            icon.className = "bi bi-eye-fill fs-4 me-2";
            indicator.innerHTML =
              '<i class="bi bi-eye-fill fs-4 me-2"></i><strong>Gaze: Looking at Screen</strong>';
          } else if (gazeState === "away") {
            indicator.classList.add("alert-warning");
            icon.className = "bi bi-eye-slash-fill fs-4 me-2";
            indicator.innerHTML =
              '<i class="bi bi-eye-slash-fill fs-4 me-2"></i><strong>Gaze: Looking Away</strong>';
          } else {
            indicator.classList.add("alert-secondary");
            indicator.innerHTML =
              '<i class="bi bi-question-circle fs-4 me-2"></i><strong>Gaze: Unknown</strong>';
          }
        },
        onStatsUpdate: (stats) => {
          // Update stats
          document.getElementById("faceCount").textContent =
            stats.faceCount || 0;
          document.getElementById("awayTime").textContent = `${
            stats.awayTime || 0
          }s`;
          document.getElementById("distractedTime").textContent = `${
            stats.distractedTime || 0
          }s`;
          document.getElementById("confidence").textContent = `${
            stats.confidence || 0
          }%`;

          // Update retina tracking stats
          document.getElementById("retinaLocationCount").textContent =
            stats.retinaLocationCount || 0;

          // Update performance stats
          document.getElementById("processingFps").textContent = Math.round(
            stats.processingFps || 0
          );
          document.getElementById("framesSkipped").textContent =
            stats.framesSkipped || 0;
          document.getElementById("canvasUpdates").textContent =
            stats.canvasUpdates || 0;
        },
      });

      // Initialize dropdowns with available modes
      function initializeControls() {
        // Populate performance mode dropdown
        const performanceModeSelect =
          document.getElementById("performanceMode");
        performanceModeSelect.innerHTML =
          '<option value="manual">Manual</option>';
        gazer.getPerformanceModes().forEach((mode) => {
          const option = document.createElement("option");
          option.value = mode.value;
          option.textContent = mode.label;
          option.title = mode.description;
          performanceModeSelect.appendChild(option);
        });
        performanceModeSelect.value = "medium"; // Set default

        // Populate sensitivity mode dropdown
        const sensitivityModeSelect =
          document.getElementById("sensitivityMode");
        sensitivityModeSelect.innerHTML =
          '<option value="manual">Manual</option>';
        gazer.getSensitivityModes().forEach((mode) => {
          const option = document.createElement("option");
          option.value = mode.value;
          option.textContent = mode.label;
          option.title = mode.description;
          sensitivityModeSelect.appendChild(option);
        });
        sensitivityModeSelect.value = "medium"; // Set default
      }

      // Initialize controls
      initializeControls();

      // Control handlers

      // Performance mode dropdown
      document
        .getElementById("performanceMode")
        .addEventListener("change", (e) => {
          const mode = e.target.value;
          gazer.setPerformanceMode(mode);

          // Update UI to reflect the preset values if not manual
          if (mode !== "manual") {
            const modes = gazer.getPerformanceModes();
            const selectedMode = gazer.performancePresets[mode];

            if (selectedMode) {
              // Update sliders to show the preset values
              document.getElementById("fpsControl").value =
                selectedMode.targetFps;
              document.getElementById(
                "fpsValue"
              ).textContent = `${selectedMode.targetFps} FPS`;

              document.getElementById("frameSkipControl").value =
                selectedMode.frameSkip;
              document.getElementById("frameSkipValue").textContent = `${
                selectedMode.frameSkip
              } frame${selectedMode.frameSkip > 1 ? "s" : ""}`;

              document.getElementById("pauseOnIdle").checked =
                selectedMode.pauseOnIdle;
              document.getElementById("reducedCanvas").checked =
                selectedMode.reducedCanvas;
            }
          }
        });

      // Sensitivity mode dropdown
      document
        .getElementById("sensitivityMode")
        .addEventListener("change", (e) => {
          const mode = e.target.value;
          gazer.setSensitivityMode(mode);

          // Update UI to reflect the preset values if not manual
          if (mode !== "manual") {
            const selectedMode = gazer.sensitivityPresets[mode];

            if (selectedMode) {
              // Update sliders to show the preset values
              document.getElementById("horizontalThreshold").value =
                selectedMode.horizontalThreshold;
              document.getElementById("horizontalValue").textContent =
                selectedMode.horizontalThreshold;

              document.getElementById("verticalThreshold").value =
                selectedMode.verticalThreshold;
              document.getElementById("verticalValue").textContent =
                selectedMode.verticalThreshold;

              document.getElementById("gazeHistorySize").value =
                selectedMode.gazeHistorySize;
              document.getElementById(
                "gazeHistoryValue"
              ).textContent = `${selectedMode.gazeHistorySize} frames`;
            }
          }
        });

      document.getElementById("fpsControl").addEventListener("input", (e) => {
        document.getElementById(
          "fpsValue"
        ).textContent = `${e.target.value} FPS`;
        gazer.setFrameRate(e.target.value);
        // Switch to manual mode when user adjusts controls
        document.getElementById("performanceMode").value = "manual";
      });

      document
        .getElementById("frameSkipControl")
        .addEventListener("input", (e) => {
          document.getElementById("frameSkipValue").textContent = `${
            e.target.value
          } frame${e.target.value > 1 ? "s" : ""}`;
          gazer.setFrameSkip(e.target.value);
          // Switch to manual mode when user adjusts controls
          document.getElementById("performanceMode").value = "manual";
        });

      document
        .getElementById("horizontalThreshold")
        .addEventListener("input", (e) => {
          document.getElementById("horizontalValue").textContent =
            e.target.value;
          gazer.setHorizontalThreshold(e.target.value);
          // Switch to manual mode when user adjusts gaze controls
          document.getElementById("sensitivityMode").value = "manual";
        });

      document
        .getElementById("verticalThreshold")
        .addEventListener("input", (e) => {
          document.getElementById("verticalValue").textContent = e.target.value;
          gazer.setVerticalThreshold(e.target.value);
          // Switch to manual mode when user adjusts gaze controls
          document.getElementById("sensitivityMode").value = "manual";
        });

      document
        .getElementById("gazeHistorySize")
        .addEventListener("input", (e) => {
          document.getElementById(
            "gazeHistoryValue"
          ).textContent = `${e.target.value} frames`;
          gazer.setGazeHistorySize(e.target.value);
          // Switch to manual mode when user adjusts gaze controls
          document.getElementById("sensitivityMode").value = "manual";
        });

      // Checkbox controls
      document.getElementById("pauseOnIdle").addEventListener("change", (e) => {
        gazer.setPauseOnIdle(e.target.checked);
        // Switch to manual mode when user adjusts controls
        document.getElementById("performanceMode").value = "manual";
      });

      document
        .getElementById("reducedCanvas")
        .addEventListener("change", (e) => {
          gazer.setReducedCanvas(e.target.checked);
          // Switch to manual mode when user adjusts controls
          document.getElementById("performanceMode").value = "manual";
        });

      document
        .getElementById("showGazeVector")
        .addEventListener("change", (e) => {
          gazer.setShowGazeVector(e.target.checked);
        });

      document
        .getElementById("showEyePoints")
        .addEventListener("change", (e) => {
          gazer.setShowEyePoints(e.target.checked);
        });

      document
        .getElementById("showFaceRectangle")
        .addEventListener("change", (e) => {
          gazer.setShowFaceRectangle(e.target.checked);
        });

      document.getElementById("enableLogs").addEventListener("change", (e) => {
        gazer.setEnableLogs(e.target.checked);
      });

      // Retina tracking controls
      document
        .getElementById("trackRetinaLocations")
        .addEventListener("change", (e) => {
          gazer.setTrackRetinaLocations(e.target.checked);
        });

      document
        .getElementById("retinaChangeThreshold")
        .addEventListener("input", (e) => {
          const threshold = parseFloat(e.target.value);
          document.getElementById(
            "retinaChangeValue"
          ).textContent = `${Math.round(threshold * 100)}%`;
          gazer.setRetinaLocationChangeThreshold(threshold);
        });

      document
        .getElementById("retinaInterval")
        .addEventListener("input", (e) => {
          const interval = parseInt(e.target.value);
          document.getElementById(
            "retinaIntervalValue"
          ).textContent = `${interval}s`;
          gazer.setRetinaLocationInterval(interval);
        });

      document.getElementById("forcePostData").addEventListener("click", () => {
        gazer.forcePostTrackingData();
      });

      // Camera control buttons
      const startBtn = document.getElementById("startBtn");
      const stopBtn = document.getElementById("stopBtn");

      startBtn.addEventListener("click", async () => {
        try {
          startBtn.disabled = true;
          startBtn.innerHTML =
            '<i class="bi bi-hourglass-split me-2"></i>Starting...';

          await gazer.start();

          startBtn.disabled = true;
          stopBtn.disabled = false;
          startBtn.innerHTML =
            '<i class="bi bi-play-fill me-2"></i>Start Camera';
        } catch (error) {
          console.error("Failed to start camera:", error);
          startBtn.disabled = false;
          startBtn.innerHTML =
            '<i class="bi bi-play-fill me-2"></i>Start Camera';
          alert(
            "Failed to start camera. Please check permissions and try again."
          );
        }
      });

      stopBtn.addEventListener("click", async () => {
        try {
          stopBtn.disabled = true;
          stopBtn.innerHTML =
            '<i class="bi bi-hourglass-split me-2"></i>Stopping...';

          await gazer.stop();

          startBtn.disabled = false;
          stopBtn.disabled = true;
          stopBtn.innerHTML = '<i class="bi bi-stop-fill me-2"></i>Stop Camera';
        } catch (error) {
          console.error("Failed to stop camera:", error);
          stopBtn.disabled = false;
          stopBtn.innerHTML = '<i class="bi bi-stop-fill me-2"></i>Stop Camera';
        }
      });
    </script>
  </body>
</html>
